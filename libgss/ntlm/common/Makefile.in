BUILD_ROOT = @builddir@/../..
SRC_ROOT=@srcdir@/../..

SHELL= /bin/sh
vpath %.c @srcdir@
vpath %.h @srcdir@

subdirs= @subdirs@
top_srcdir= @top_srcdir@
srcdir = @srcdir@
ntlm_srcdir = @ntlm_srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = ${exec_prefix}/bin
infodir = ${prefix}/info
libdir = @libdir@
incdir = ${prefix}/include
mandir = ${prefix}/man/man1

DESTDIR=@DESTDIR@
CC = @CC@
CPPFLAGS = @CPPFLAGS@
CFLAGS = $(CPPFLAGS) @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
INSTALL = @INSTALL@
LIBVER_MAJOR=@LIBVER_MAJOR@
SHLIBVEXT=@SHLIBVEXT@
LINK=@LINK@

CFLAGS += -DLSA_PREFIX_PATH=\"@prefix@\"
CFLAGS += @GSSNTLM_PRIVATE_INCLUDE@
CFLAGS += @LSA_INCLUDE@

LDFLAGS += @LSAUTILS_LDFLAGS@
LDFLAGS += @LIBUNISTR_LDFLAGS@
LDFLAGS += @CRYPTOLIB@

LIBS += @LIBUNISTR_LIBS@

OBJS = \
       debug.o      \
       ntlmcrypt.o  \
       ntlmdlist.o  \
       ntlmencode.o \
       utils.o

LIBNAME = ntlmcommon
LIBRARY = lib$(LIBNAME).a
SHLIBRARY = lib$(LIBNAME)$(SHLIBVEXT)
SHLIBRARY_SANS_VERSION = lib$(LIBNAME)@SHLIBEXT@

all : $(SHLIBRARY)

$(SHLIBRARY) : $(LIBRARY)
	@BUILD_SHLIB_CMD@
	$(RM) $(SHLIBRARY_SANS_VERSION)
	@LINK@ $(SHLIBRARY) $(SHLIBRARY_SANS_VERSION)

$(LIBRARY) : $(OBJS)
	$(AR) -r $@ $(OBJS)

$(OBJS) : %.o : %.c
	$(CC) -c $(CFLAGS) $< -o $@

clean :
	$(RM) $(OBJS) $(LIBRARY) $(SHLIBRARY) $(SHLIBRARY_SANS_VERSION)

distclean: clean
	$(RM) Makefile

install: all
	$(top_srcdir)/mkinstalldirs $(DESTDIR)/$(libdir)
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY)
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY_SANS_VERSION)
	$(top_srcdir)/install-sh -c -m 644 $(SHLIBRARY) $(DESTDIR)/$(libdir)
	@LINK@ $(DESTDIR)/$(libdir)/$(SHLIBRARY) $(DESTDIR)/$(libdir)/$(SHLIBRARY_SANS_VERSION)
        
uninstall:
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY)
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY_SANS_VERSION)

