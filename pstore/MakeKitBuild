SUBDIRS='include utils logging providers api'

configure()
{
    mk_config_header \
        HEADER="include/config.h"

    MK_CFLAGS="$MK_CFLAGS -Wall -Werror -fno-strict-aliasing"

    lw_define_feature_macros

    mk_define MOD_EXT "\"$MK_DLO_EXT\""
    mk_define PREFIXDIR "\"$MK_PREFIX\""
    mk_define LIBDIR "\"$MK_LIBDIR\""
    mk_define ENABLE_REGDB

    mk_export MOD_EXT="$MK_DLO_EXT"
    mk_export LIBDIR="$MK_LIBDIR"

    mk_check_headers FAIL=yes \
        lwmsg/lwmsg.h reg/reg.h wc16str.h

    mk_check_libraries FAIL=yes \
        lwmsg regclient

    mk_check_functions \
        HEADERDEPS="time.h string.h sys/select.h syslog.h stdlib.h" \
        localtime_r memset select strchr strerror vsyslog strtoll

    lw_check_strerror_r

    mk_output_file "etc/pstore.reg"
}
