BUILD_ROOT = @builddir@/..
SRC_ROOT=@srcdir@/..

SHELL= /bin/sh
#64 bit libs on IA64. When VPATH is set, it verifies all the dependencies from the
#@srcdir@ and as the SHLLIBRARY is already present, it does not build.
#VPATH= @srcdir@
vpath %.c @srcdir@
vpath %.h @srcdir@

subdirs= @subdirs@
top_srcdir= @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = ${exec_prefix}/bin
infodir = ${prefix}/info
libdir = @libdir@
mandir = ${prefix}/man/man1

DESTDIR=@DESTDIR@
CC = @CC@
CPP = @CPP@
CPPFLAGS = @CPPFLAGS@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
LIBVER_MAJOR = @LIBVER_MAJOR@
DYNLIBEXT = @DYNLIBEXT@
LINK = @LINK@
MOONUNIT_STUB = @MOONUNIT_STUB@
LIB_moonunit = @LIB_moonunit@

PUBLIC_INCLUDE_DIR = $(BUILD_ROOT)/include

CPPFLAGS += -I$(PUBLIC_INCLUDE_DIR) -I$(BUILD_ROOT)/libcentutils -I$(BUILD_ROOT)/libgpglib
CFLAGS += -Wall $(CPPFLAGS)
LDFLAGS += -L$(BUILD_ROOT)/libcentutils -L$(BUILD_ROOT)/libgpglib -lcentutils -lgpglib $(LIB_moonunit)

OBJS = test_ctshell.o test_stub.o

LIBNAME = centutils_mu
DYNLIBRARY = $(LIBNAME)@DYNLIBEXT@

all : $(DYNLIBRARY)

$(DYNLIBRARY) : $(OBJS)
	@BUILD_DYNLIB_CMD@

$(OBJS) : %.o : %.c
	$(CC) -c $(CFLAGS) $< -o $@

test_stub.c: test_ctshell.c
	$(MOONUNIT_STUB) CPP="$(CPP)" CPPFLAGS="$(CPPFLAGS)" -o $@ $<

clean :
	$(RM) $(OBJS) $(LIBRARY) $(SHLIBRARY) $(SHLIBRARY_SANS_VERSION)

distclean: clean
	$(RM) Makefile

install: all
	$(top_srcdir)/mkinstalldirs $(DESTDIR)/$(libdir)
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY_SANS_VERSION)
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY)
	$(top_srcdir)/install-sh -c -m 0755 $(SHLIBRARY) $(DESTDIR)/$(libdir)/$(SHLIBRARY)
	$(LINK) $(SHLIBRARY) $(DESTDIR)/$(libdir)/$(SHLIBRARY_SANS_VERSION)

uninstall:
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY_SANS_VERSION)
	$(RM) $(DESTDIR)/$(libdir)/$(SHLIBRARY)
