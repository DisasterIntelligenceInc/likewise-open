<?xml version="1.0"?>
<project>
  <target name="local.build">
    <cl outputdir="${build.meta.current}/">
      <includedirs>
        <include name="include"/>
        <include name="include\lw"/>
        <include name="include\win32"/>
        <include name="..\libunistr\include"/>
      </includedirs>
      <sources>
	<include name="src/rtlmemory.c"/>
	<include name="src/rtlstring*.c"/>
      </sources>
      <defines>
        <define name="UNICODE"/>
        <define name="_UNICODE"/>
        <define name="WIN32"/>
        <define name="_WINDOWS"/>
        <define name="NDEBUG"/>
        <define name="_USRDLL"/>
        <define name="LWBASE_EXPORTS"/>
      </defines>
	<arg line="/O2 /GL /FD /EHsc /Wp64 /Zi /MD /W3" />
    </cl>
    <link output="${build.meta.current}/lwbase.dll" options="/dll">
      <sources basedir="${build.meta.current}/">
	<include name="*.obj"/>
	<include name="${build.meta.current}\..\libunistr\libunistr.lib"/>
      </sources>
      <arg value="/DEF:lwbase.def"/>
    </link>
    <exec program="mt.exe">
      <arg line="-manifest lwbase.dll.manifest -outputresource:${build.meta.current}/lwbase.dll;2" />
    </exec>
    <copy todir="${build.dist.os}">
      <fileset basedir="${build.meta.current}">
	<include name="*.dll"/>
	<include name="*.exe"/>
      </fileset>
    </copy>
  </target>
</project>
