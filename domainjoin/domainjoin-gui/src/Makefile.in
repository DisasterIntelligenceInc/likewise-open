##
## Copyright (C) Centeris Corporation 2004-2007
## Copyright (C) Likewise Software 2007.
## All rights reserved.
##
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 3 of the License, or
## (at your option) any later version.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with this program.  If not, see <http:##www.gnu.org/licenses/>.
##

BUILD_ROOT = ../..

SHELL= /bin/sh
VPATH= @srcdir@

subdirs= @subdirs@
top_srcdir= @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = ${exec_prefix}/bin
sbindir = ${exec_prefix}/sbin
infodir = ${prefix}/info
libdir = ${prefix}/lib
mandir = ${prefix}/man/man1
sharedir = ${prefix}/share

DESTDIR=@DESTDIR@
CC = @CC@
CPPFLAGS = @CPPFLAGS@ -DSHARE_DIR=\"$(sharedir)\"
CFLAGS = $(CPPFLAGS) @CFLAGS@ -Wall
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
INSTALL = @INSTALL@
LWI_OS_FLAGS = @LWI_OS_FLAGS@

PUBLIC_INCLUDE_DIR = $(BUILD_ROOT)/include
PROJECT_INCLUDE_DIR = ../include
DOMAINJOIN_DIR = $(BUILD_ROOT)/libdomainjoin
CENTUTILS_DIR = $(BUILD_ROOT)/libcentutils

DOMAINJOIN_LIB = $(DOMAINJOIN_DIR)/src/libdomainjoin.a
CENTUTILS_LIB = $(CENTUTILS_DIR)/libcentutils.a

INCLUDES += -I$(PROJECT_INCLUDE_DIR)    \
            -I$(DOMAINJOIN_DIR)/include \
	    -I$(CENTUTILS_DIR)		\
            -I$(PUBLIC_INCLUDE_DIR)

CFLAGS += $(INCLUDES) \
          $(LWI_OS_FLAGS) \
	  @GTK_CFLAGS@

LIBS += $(DOMAINJOIN_LIB) $(CENTUTILS_LIB) @GTK_LIBS@

OBJS = common.o joindialog.o joinprogress.o statusdialog.o \
       joinauth.o joinerror.o main.o

PROGRAM = domainjoin-gui

all : $(PROGRAM)

$(PROGRAM) : $(OBJS) $(DOMAINJOIN_LIB)
	$(CC) -o $@ $(OBJS) $(LDFLAGS) $(LIBS)

$(OBJS) : %.o : %.c
	$(CC) -c $(CFLAGS) $< -o $@

clean :
	$(RM) $(OBJS) $(PROGRAM)

distclean:
	$(RM) Makefile

install: all
	@echo $(DESTDIR)
	$(top_srcdir)/mkinstalldirs $(DESTDIR)$(bindir)
	$(top_srcdir)/mkinstalldirs $(DESTDIR)$(libdir)
	$(top_srcdir)/mkinstalldirs $(DESTDIR)$(sharedir)//likewise-open
	$(INSTALL) $(PROGRAM) $(DESTDIR)$(bindir)
	$(INSTALL) domainjoin-gtk.glade $(DESTDIR)$(sharedir)/likewise-open

uninstall:
	-/bin/rm -f $(DESTDIR)$(bindir)/$(PROGRAM)

