make()
{
    COMMON_SOURCES="globals.c listener.c"
    LWREG_SOURCES="$COMMON_SOURCES main-svcm.c"

    lw_service \
	SERVICE="lwreg" \
        SOURCES="$LWREG_SOURCES" \
        GROUPS="../api/regserverapi" \
        CPPFLAGS="-DPREFIXDIR=\"${MK_PREFIX}\"" \
        INCLUDEDIRS="../../include ../include" \
        HEADERDEPS="lw/base.h lwmsg/lwmsg.h" \
        LIBDEPS="lwmsg lwmsg_nothr"

    mk_stage \
        SOURCE=lwreg.reg \
        DESTDIR="${LW_CONFIGDIR}"

    if [ "$LWREG_LWREGD_SERVER" = "yes" ]; then
        mk_check_libraries \
            pthread dl

        mk_program \
            PROGRAM="lwregd" \
            SOURCES="lwregd.c" \
            LIBDEPS="pthread dl" \
            INSTALLDIR="${MK_SBINDIR}"
    fi
}
